# HO-Kit 桌面客户端（新版本测试中）

![GitHub stars](https://img.shields.io/github/stars/yabi-zzh/HarmonyScrcpy?style=social)
![GitHub downloads](https://img.shields.io/github/downloads/yabi-zzh/HarmonyScrcpy/total)
![GitHub release](https://img.shields.io/github/v/release/yabi-zzh/HarmonyScrcpy)

> 一站式 HarmonyOS NEXT 应用开发辅助工具：低延迟投屏、实时性能监控、一键重签名、文件管理等

---

## 功能亮点

| 功能 | 说明 |
|------|------|
| **高性能投屏** | 支持 H.264/JPEG 双模式，最高 120fps，USB + H.264 模式延迟 10ms 内 |
| **UIViewer** | 实时获取 UI 树结构，Hover 联动高亮控件，支持 XPath 查询 |
| **截图录屏** | 一键截图保存，MP4 格式录屏，支持自定义保存路径 |
| **性能监控** | FPS、CPU、GPU、内存、网络流量实时采集，时间轴图表展示 |
| **应用重签名** | 可视化重签流程，自动获取华为开发者证书和 Profile |
| **扩展功能** | 电脑键盘输入中英文、手机音频同步到电脑、HID 键鼠模式 |
| **工具箱** | 终端 Shell、文件管理、媒体管理、实时日志查看 |

---

## 下载安装

前往 [Releases](https://github.com/yabi-zzh/HarmonyScrcpy/releases) 页面下载：

| 操作系统 | 安装包 | 说明 |
|---------|--------|------|
| Windows | `.exe` | 双击运行安装程序，按提示完成安装 |
| macOS | `.dmg` | 打开后将应用拖入 Applications 文件夹 |
| Linux | `.AppImage` | 通用格式，添加执行权限后直接运行 |

> **macOS 用户注意**：首次打开如提示"应用已损坏"或"无法验证开发者"，请在终端执行：
> ```bash
> sudo xattr -rd com.apple.quarantine /Applications/HO-Kit.app
> ```

### 环境要求

| 要求 | 说明 |
|------|------|
| **设备连接** | USB 数据线连接，或 WiFi 无线连接（需先执行 `hdc tconn IP:端口`） |
| **开发者模式** | 设备需开启「开发者选项」和「USB 调试」 |
| **HDC 工具** | 已内置，无需额外配置；如系统 PATH 中已有 HDC，优先使用系统版本 |
| **Java 环境** | 已内置 JRE，无需额外配置（仅重签名功能需要） |

### 账号要求（部分功能）

以下功能需要登录华为开发者账号：
- **设备注册**：将设备 UDID 注册到开发者账号
- **证书管理**：查看和管理调试/发布证书
- **应用重签名**：使用账号下的证书对应用包进行重签名

> 设备投屏、性能监控、应用解析等功能无需登录，纯本地操作。

---

## 功能详解

### 设备投屏

将 HarmonyOS NEXT 设备屏幕实时投射到电脑，支持鼠标远程操作。

**投屏模式**：
| 模式 | 特点 | 适用场景 |
|------|------|----------|
| H.264 | 高画质、低延迟（USB 下 10ms 内）、支持 120fps、使用硬件解码 | HarmonyOS NEXT 设备，追求流畅体验 |
| JPEG | 兼容性好，无需硬件解码支持 | H.264 不可用时的备选方案 |

**操作功能**：
- **窗口控制**：缩放、双击适配画面、屏幕旋转、窗口置顶、屏幕常亮
- **远程按键**：返回键、Home 键、多任务键、电源键
- **鼠标快捷键**：中键 Home、右键返回、侧键 4 多任务、侧键 5 通知栏
- **截图录屏**：一键截图、MP4 格式录制，可自定义保存路径
- **折叠屏支持**：自动检测折叠状态，实时适配分辨率变化

**使用步骤**：
1. 在左侧导航栏点击「设备投屏」，进入设备列表
2. 确认目标设备状态为「在线」
3. 点击设备卡片上的「开始投屏」按钮
4. 在投屏窗口中操作设备，顶部菜单可访问更多功能

### UIViewer

内置于投屏窗口，用于查看和分析当前界面的控件结构。

**功能特性**：
- 获取当前页面完整的 UI 树结构
- 鼠标 Hover 画面时自动高亮对应控件
- 点击画面选中控件，查看详细属性
- 支持 XPath 查询定位控件

**控件属性**：
- 基础信息：id、text、type、description
- 布局信息：bounds（位置和尺寸）
- 交互状态：clickable、focusable、enabled、selected

**使用步骤**：
1. 开始投屏后，点击投屏窗口顶部菜单按钮
2. 选择「工具」→「UIViewer」打开 UI 结构面板
3. 点击「获取布局」按钮获取当前页面 UI 树
4. 在画面上 Hover 或点击查看控件信息

### 性能监控

实时采集设备和应用的性能指标，帮助分析性能瓶颈。

**监控指标**：
| 指标 | 说明 |
|------|------|
| **FPS** | 帧率、刷新率、卡顿次数 |
| **CPU** | 进程 CPU 占用、系统总 CPU 占用、各核心频率和使用率 |
| **GPU** | GPU 负载百分比 |
| **内存** | PSS、Heap Size、Heap Alloc、系统可用内存、总内存（MB） |
| **网络** | 上行/下行流量速率（KB/s） |

**使用步骤**：
1. 在左侧导航栏点击「性能监控」
2. 在页面顶部选择目标设备
3. 点击「选择应用」，从已安装应用列表中选择要监控的应用
4. 点击「开始监控」，图表区域将实时显示各项指标
5. 点击「停止监控」结束采集，可回顾历史趋势

**注意事项**：
- 性能采集会占用一定设备资源
- 部分指标（如 GPU 负载）需要设备系统版本支持，不同设备可能有差异

### 应用解析

快速解析 HAP/APP/HSP 应用包，查看包内详细信息。

**功能特性**：
- 支持拖拽或点击选择应用包文件
- 解析并展示：包名、版本号、应用名称、图标
- 查看权限列表和包内文件结构
- 方便在安装或重签前确认包信息

**使用步骤**：
1. 在左侧导航栏点击「应用解析」
2. 将 HAP/APP/HSP 文件拖入上传区域，或点击选择文件
3. 等待解析完成，查看包的详细信息

### 应用重签名

对 HAP/APP/HSP 应用包进行重签名，使其可以安装到已注册的调试设备上。

**功能特性**：
- 自动解析包信息（包名、版本号、应用名称、图标）
- 自动获取华为开发者账号下的证书和 Profile
- 可视化进度条和详细日志，失败时展示具体错误原因
- 成功后可一键打开输出目录

**前置条件**：
- 已登录华为开发者账号
- 账号下有有效的调试证书和 Profile 文件
- 目标安装设备的 UDID 已注册到该账号

**使用步骤**：
1. 在左侧导航栏点击「应用重签名」
2. 将 HAP/APP/HSP 文件拖入上传区域，或点击选择文件
3. 确认解析出的包信息正确
4. 点击「开始重签名」按钮
5. 在日志区域查看重签进度，等待完成
6. 成功后点击「输出目录」按钮查看重签后的应用包

**注意事项**：
- 重签名仅用于调试目的，发布应用请使用正式的发布证书
- **同应用多包签名顺序**：如果同一应用有多个 HAP/HSP 包需要分开签名，请先签名 HAP 主包，再签名 HSP 共享包，否则可能出现 ACL 权限缺失问题

### 设备管理与注册

查看已连接的设备信息，并将设备注册到华为开发者账号。

**功能特性**：
- 展示设备详细信息：名称、型号、UDID、ABI 架构、系统版本、屏幕分辨率、电池状态
- 自动识别设备是否已注册，避免重复占用名额
- 支持批量选择未注册设备进行快速注册

**使用步骤**：
1. 在「重签名」页面切换到「已注册设备」标签页
2. 查看当前账号下已注册的设备列表
3. 点击「快速注册」按钮，选择需要注册的本地设备
4. 确认后提交注册

**注意事项**：
- 华为开发者账号的调试设备注册数量有上限（100 台）
- 如需注销设备，请前往华为开发者联盟官网操作

### 扩展功能

在投屏时启用额外的扩展功能。

**前置条件**：
- 需要在手机上安装 HoKit 服务应用（包名：`com.hokit.app`）
- HAP 安装包随 HO-Kit 一起分发，位于安装目录的 `assets/tools/hap/` 下
- 需通过「应用重签名」功能签名后安装到设备

#### 输入法服务
- 使用电脑键盘直接在手机上输入中英文
- 支持拼音输入（由手机端处理）
- 支持常用快捷键（Ctrl+A/C/V/Z 等）

#### 音频同步服务
- 将手机音频实时同步到电脑播放，实现投屏时的音画同步
- 启动后系统会弹出「屏幕隐私保护」权限弹窗，工具会自动点击授权

#### HID 键鼠模式（Beta）
- 通过 USB 直接发送 HID 输入
- 支持鼠标灵敏度调节

**使用步骤**：
1. 开始投屏后，点击投屏窗口顶部菜单按钮
2. 选择「工具」→「扩展功能」
3. 在弹出的窗口中，根据需要启用输入法或音频服务

### 工具箱

集成常用的设备调试工具。

| 功能 | 说明 |
|------|------|
| **终端** | Shell 会话管理，直接在设备上执行命令 |
| **文件管理** | 文件上传/下载，支持按日期排序，批量操作 |
| **媒体管理** | 图片/视频预览，批量管理设备媒体文件 |
| **日志查看** | 实时查看设备 hilog 日志 |

---

## 常见问题

### 设备连接问题

**Q: 设备列表中看不到我的设备？**
- 检查 USB 线是否正常连接，尝试更换 USB 口或数据线
- 确认设备已开启「开发者选项」和「USB 调试」
- 在终端执行 `hdc list targets` 确认 HDC 能识别到设备
- 如果使用网络连接，确认已执行 `hdc tconn <IP>:<端口>`
- Windows 用户检查是否安装了正确的 USB 驱动

**Q: 设备显示「离线」状态？**
- 检查设备上是否弹出了 USB 调试授权提示，点击「允许」
- 尝试拔插 USB 线重新连接
- 在设备上关闭再重新开启「USB 调试」选项
- 重启 HO-Kit 和设备

**Q: WiFi 连接设备失败？**
- 确保设备和电脑在同一局域网内
- 确认设备的 IP 地址正确
- 检查防火墙是否阻止了连接
- 先通过 USB 连接成功后，再执行 `hdc tconn <IP>:<端口>`

### 投屏问题

**Q: 投屏画面黑屏？**
- 尝试切换投屏模式（H.264 → JPEG 或反之）
- 检查设备是否支持当前投屏模式
- 首次投屏需要推送 Agent 程序，等待推送完成
- 重启 HO-Kit 和设备后重试

**Q: 投屏画面卡顿或延迟高？**
- USB 连接比 WiFi 连接延迟更低，优先使用 USB
- 检查 USB 线是否为高速数据线（非充电线）
- 尝试切换投屏模式（H.264 / JPEG）
- 关闭其他占用 USB 带宽的设备

**Q: 投屏窗口操作无响应？**
- 检查设备上是否有系统弹窗阻挡
- 确认投屏连接状态正常（查看状态栏）
- 尝试重新开始投屏

**Q: 折叠屏设备投屏画面异常？**
- HO-Kit 会自动适配折叠屏分辨率变化
- 如果画面比例异常，尝试重新开始投屏
- 确保使用最新版本的 HO-Kit

### 重签名问题

**Q: 重签名失败？**
- 确认已登录华为开发者账号
- 检查证书是否过期（证书有效期通常为 1 年）
- 确认目标设备的 UDID 已注册到当前账号
- 查看日志区域的详细错误信息

**Q: 重签名后的应用安装失败？**
- 确认设备 UDID 在签名使用的 Profile 中
- 如果是同应用多包，检查签名顺序是否正确（先 HAP 后 HSP）
- 检查设备上是否已安装同包名的应用，尝试先卸载

**Q: 登录华为账号失败？**
- 确认网络连接正常
- 检查华为开发者账号是否已完成实名认证
- 尝试在浏览器中登录华为开发者联盟确认账号状态

### 性能监控问题

**Q: 性能数据采集不到？**
- 确认设备已正常连接
- 确认已选择要监控的应用
- 部分指标需要特定系统版本支持
- 尝试重新选择设备和应用

**Q: FPS 数据显示异常？**
- 确保监控的应用正在前台运行
- 某些系统界面可能不返回 FPS 数据
- 检查设备系统版本是否支持 FPS 采集

### 扩展功能问题

**Q: 输入法服务无法使用？**
- 确认已安装 HoKit 服务应用并完成签名
- HarmonyOS 6.0+ 支持命令行切换输入法，5.0 需手动在设置中切换
- 检查扩展服务连接状态

**Q: 音频同步没有声音？**
- 确认已授权「屏幕隐私保护」权限
- 检查电脑音频输出设备是否正确
- 确认手机正在播放音频

---

## 问题反馈

如果你在使用过程中遇到问题或有功能建议，欢迎提交 Issue。

**提交地址**：[GitHub Issues](https://github.com/yabi-zzh/HarmonyScrcpy/issues)

### Issue 提交建议

**Bug 反馈**请尽量包含：
- 问题描述和复现步骤
- 操作系统、HO-Kit 版本、设备型号
- 相关错误日志或截图

**功能建议**请说明：
- 期望的功能和使用场景

---

## 技术栈

| 技术 | 版本 | 说明 |
|------|------|------|
| Electron | 34.x | 跨平台桌面应用框架 |
| Vue 3 | 3.5.x | 渲染进程前端框架 |
| TypeScript | 5.x | 类型安全 |
| Naive UI | 2.40.x | Vue 3 组件库 |
| Vite | 7.x | 前端构建工具 |
| Pinia | 2.x | 状态管理 |
| gRPC | - | H.264 投屏数据传输 |
| WebCodecs | - | 视频硬件解码 |
| ECharts | - | 性能监控图表 |

---

## Star History

[![Star History Chart](https://api.star-history.com/svg?repos=yabi-zzh/HarmonyScrcpy&type=Date)](https://star-history.com/#yabi-zzh/HarmonyScrcpy&Date)
